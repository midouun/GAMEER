<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø³Ø¨Ø§Ù‚ Ø§Ù„Ø£Ø³Ø§Ø·ÙŠØ± - Ù…Ø­Ù…Ø¯ Ø¨ÙˆÙ„Ù†ÙˆØ§Ø±</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            overflow: hidden;
            background: #0a0a0a;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            touch-action: none;
            height: 100vh;
        }

        /* Ø®Ù„ÙÙŠØ© Ù…ØªØ­Ø±ÙƒØ© */
        .game-container {
            position: relative;
            width: 100%;
            height: 100%;
            background: #1a1a1a;
            overflow: hidden;
        }

        .speed-lines {
            position: absolute;
            width: 100%;
            height: 100%;
            background-image: 
                linear-gradient(0deg, transparent 24%, rgba(255,255,255,.05) 25%, rgba(255,255,255,.05) 26%, transparent 27%, transparent 74%, rgba(255,255,255,.05) 75%, rgba(255,255,255,.05) 76%, transparent 77%, transparent),
                linear-gradient(90deg, transparent 24%, rgba(255,255,255,.05) 25%, rgba(255,255,255,.05) 26%, transparent 27%, transparent 74%, rgba(255,255,255,.05) 75%, rgba(255,255,255,.05) 76%, transparent 77%, transparent);
            background-size: 50px 50px;
            animation: moveGrid 1s linear infinite;
            opacity: 0.3;
        }

        @keyframes moveGrid {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        /* Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© */
        .ui-layer {
            position: absolute;
            top: 0;
            width: 100%;
            z-index: 100;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            pointer-events: none;
        }

        .stats-box {
            background: rgba(0,0,0,0.7);
            border: 2px solid #00f3ff;
            border-radius: 15px;
            padding: 10px 15px;
            color: white;
            text-align: right;
            backdrop-filter: blur(10px);
        }

        .stats-box h3 {
            color: #00f3ff;
            font-size: 0.9rem;
            text-shadow: 0 0 10px #00f3ff;
            margin-bottom: 5px;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 5px 0;
            font-size: 1.1rem;
            font-weight: bold;
        }

        .speedometer {
            font-size: 2rem;
            color: #00ff66;
            text-shadow: 0 0 20px #00ff66;
        }

        /* Ø§Ù„Ø³ÙŠØ§Ø±Ø© */
        .car-wrapper {
            position: absolute;
            width: 60px;
            height: 110px;
            z-index: 10;
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.8));
        }

        .car-body {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #ffcc00, #ff9900);
            border-radius: 15px;
            position: relative;
            border: 3px solid rgba(255,255,255,0.3);
        }

        .car-body.blue { background: linear-gradient(135deg, #00f3ff, #0099ff); }
        .car-body.red { background: linear-gradient(135deg, #ff0055, #cc0044); }

        .hood-vent {
            position: absolute;
            top: 15px;
            left: 20%;
            width: 60%;
            height: 20px;
            background: rgba(0,0,0,0.4);
            border-radius: 5px;
        }

        .roof {
            position: absolute;
            top: 40px;
            left: 5px;
            width: 50px;
            height: 35px;
            background: #111;
            border-radius: 8px 8px 12px 12px;
            border: 2px solid #333;
        }

        .roof::after {
            content: '';
            position: absolute;
            top: 2px; bottom: 2px; left: 2px; right: 2px;
            background: linear-gradient(45deg, #1a1a1a, #444);
            border-radius: 6px;
        }

        .spoiler {
            position: absolute;
            bottom: 5px;
            left: -5px;
            width: 70px;
            height: 10px;
            background: #333;
            border-radius: 5px;
        }

        .lights-front::before, .lights-front::after {
            content: '';
            position: absolute;
            top: -2px;
            width: 12px;
            height: 8px;
            background: #fff;
            border-radius: 50%;
            box-shadow: 0 -20px 40px rgba(255,255,255,0.8);
        }

        .lights-front::before { left: 5px; }
        .lights-front::after { right: 5px; }

        .nitro-flame {
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 15px;
            height: 0;
            background: radial-gradient(ellipse at center, #00f3ff 0%, #0099ff 50%, transparent 70%);
            border-radius: 50%;
            opacity: 0;
            filter: blur(5px);
            transition: all 0.2s;
        }

        .nitro-flame.active {
            opacity: 1;
            height: 60px;
            animation: flameFlicker 0.1s infinite;
        }

        @keyframes flameFlicker {
            0%, 100% { height: 55px; }
            50% { height: 65px; }
        }

        /* Ø§Ù„Ø¹Ù…Ù„Ø§Øª ÙˆØ§Ù„Ø¨ÙˆÙ†ØµØ§Øª */
        .coin {
            position: absolute;
            width: 35px;
            height: 35px;
            background: radial-gradient(circle, #ffd700, #ffaa00);
            border-radius: 50%;
            border: 3px solid #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            animation: coinSpin 2s linear infinite, coinFloat 1.5s ease-in-out infinite;
            box-shadow: 0 0 20px #ffd700;
            z-index: 5;
        }

        @keyframes coinSpin {
            0%, 100% { transform: rotateY(0deg) scale(1); }
            50% { transform: rotateY(180deg) scale(1.1); }
        }

        @keyframes coinFloat {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .powerup {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            animation: pulse 1s infinite;
            z-index: 5;
            border: 2px solid white;
        }

        .powerup.shield { background: linear-gradient(135deg, #00f3ff, #0066ff); }
        .powerup.multi { background: linear-gradient(135deg, #ff00ff, #9900ff); }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }

        /* Ø¬Ø²ÙŠØ¦Ø§Øª */
        .particle {
            position: absolute;
            background: rgba(255,255,255,0.6);
            border-radius: 50%;
            pointer-events: none;
            animation: fadeOut 1s forwards;
            z-index: 1;
        }

        .skid-mark {
            position: absolute;
            background: rgba(0,0,0,0.4);
            width: 8px;
            height: 8px;
            border-radius: 50%;
            pointer-events: none;
            animation: fadeSkid 3s forwards;
            z-index: 1;
        }

        @keyframes fadeOut {
            to { opacity: 0; transform: scale(2); }
        }

        @keyframes fadeSkid {
            to { opacity: 0; }
        }

        /* Ø§Ù„ØªØ­ÙƒÙ… */
        .controls-overlay {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 200px;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            padding: 20px;
            z-index: 200;
        }

        .ctrl-btn {
            border-radius: 50%;
            border: 3px solid rgba(255,255,255,0.3);
            background: rgba(0,0,0,0.6);
            color: #fff;
            font-size: 24px;
            backdrop-filter: blur(10px);
            outline: none;
            user-select: none;
            transition: all 0.1s;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }

        .ctrl-btn:active {
            transform: scale(0.9);
            background: rgba(255,255,255,0.3);
        }

        .d-pad {
            display: flex;
            gap: 15px;
        }

        .left-btn, .right-btn {
            width: 70px;
            height: 70px;
            background: rgba(0,243,255,0.2);
            border-color: #00f3ff;
        }

        .pedals {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 15px;
        }

        .nitro-btn {
            width: 60px;
            height: 60px;
            background: rgba(0,243,255,0.3);
            border-color: #00f3ff;
            font-size: 18px;
        }

        .nitro-btn:active {
            background: #00f3ff;
            box-shadow: 0 0 30px #00f3ff;
        }

        .pedal-group {
            display: flex;
            gap: 15px;
        }

        .gas-btn {
            width: 85px;
            height: 85px;
            background: rgba(0,255,102,0.3);
            border-color: #00ff66;
            font-size: 32px;
        }

        .gas-btn:active { background: #00ff66; }

        .brake-btn {
            width: 65px;
            height: 65px;
            background: rgba(255,0,85,0.3);
            border-color: #ff0055;
            align-self: flex-end;
        }

        .brake-btn:active { background: #ff0055; }

        /* Ø´Ø§Ø´Ø© Game Over */
        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: rgba(0,0,0,0.95);
            border: 3px solid #00f3ff;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            z-index: 300;
            opacity: 0;
            transition: all 0.3s;
            backdrop-filter: blur(20px);
        }

        .game-over.show {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }

        .game-over h2 {
            color: #ff0055;
            font-size: 2.5rem;
            margin-bottom: 20px;
            text-shadow: 0 0 20px #ff0055;
        }

        .game-over p {
            color: white;
            font-size: 1.3rem;
            margin: 10px 0;
        }

        .game-over button {
            margin-top: 20px;
            padding: 15px 40px;
            font-size: 1.2rem;
            background: linear-gradient(135deg, #00f3ff, #0099ff);
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 20px rgba(0,243,255,0.5);
        }

        .game-over button:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 30px rgba(0,243,255,0.8);
        }

        /* Ø´Ø§Ø´Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³ÙŠØ§Ø±Ø© */
        .car-select {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 400;
        }

        .car-select h2 {
            color: #00f3ff;
            font-size: 2rem;
            margin-bottom: 40px;
            text-shadow: 0 0 20px #00f3ff;
        }

        .car-options {
            display: flex;
            gap: 30px;
        }

        .car-option {
            background: rgba(255,255,255,0.1);
            border: 3px solid #00f3ff;
            border-radius: 15px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .car-option:hover {
            transform: scale(1.1);
            box-shadow: 0 0 30px #00f3ff;
        }

        .car-option.locked {
            opacity: 0.5;
            cursor: not-allowed;
            border-color: #666;
        }

        .car-preview {
            width: 80px;
            height: 140px;
            margin-bottom: 10px;
            position: relative;
        }

        .car-option h3 {
            color: white;
            margin: 10px 0;
        }

        .car-option p {
            color: #aaa;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="car-select" id="carSelect">
        <h2>ğŸï¸ Ø§Ø®ØªØ± Ø³ÙŠØ§Ø±ØªÙƒ ğŸ</h2>
        <div class="car-options">
            <div class="car-option" data-car="yellow">
                <div class="car-preview">
                    <div class="car-wrapper" style="position:static;">
                        <div class="car-body"><div class="roof"></div></div>
                    </div>
                </div>
                <h3>Ø§Ù„Ø¨Ø±Ù‚ Ø§Ù„Ø°Ù‡Ø¨ÙŠ</h3>
                <p>âš¡ Ø³Ø±Ø¹Ø© Ù…ØªÙˆØ§Ø²Ù†Ø©</p>
                <p>ğŸ†“ Ù…Ø¬Ø§Ù†ÙŠØ©</p>
            </div>
            
            <div class="car-option" data-car="blue">
                <div class="car-preview">
                    <div class="car-wrapper" style="position:static;">
                        <div class="car-body blue"><div class="roof"></div></div>
                    </div>
                </div>
                <h3>Ø§Ù„Ù†ÙŠÙˆÙ† Ø§Ù„Ø£Ø²Ø±Ù‚</h3>
                <p>ğŸš€ Ø³Ø±Ø¹Ø© ÙØ§Ø¦Ù‚Ø©</p>
                <p>ğŸª™ 50 Ø¹Ù…Ù„Ø©</p>
            </div>
            
            <div class="car-option locked" data-car="red">
                <div class="car-preview">
                    <div class="car-wrapper" style="position:static;">
                        <div class="car-body red"><div class="roof"></div></div>
                    </div>
                </div>
                <h3>Ø§Ù„Ø´ÙŠØ·Ø§Ù† Ø§Ù„Ø£Ø­Ù…Ø±</h3>
                <p>ğŸ’ª Ù‚ÙˆØ© Ø®Ø§Ø±Ù‚Ø©</p>
                <p>ğŸª™ 100 Ø¹Ù…Ù„Ø©</p>
            </div>
        </div>
    </div>

    <div class="ui-layer">
        <div class="stats-box">
            <h3>ğŸ“Š Ù…Ø­Ù…Ø¯ Ø¨ÙˆÙ„Ù†ÙˆØ§Ø±</h3>
            <div class="stat-item">ğŸª™ <span id="coins">0</span></div>
            <div class="stat-item">â­ <span id="score">0</span></div>
            <div class="stat-item">ğŸ† Ù…Ø³ØªÙˆÙ‰ <span id="level">1</span></div>
        </div>
        <div class="stats-box">
            <div class="speedometer"><span id="speedVal">0</span> ÙƒÙ…/Ø³</div>
        </div>
    </div>

    <div class="game-container">
        <div class="speed-lines"></div>
        <div id="gameWorld" style="position:absolute;width:100%;height:100%;">
            <div id="skidMarksContainer"></div>
            <div id="coinsContainer"></div>
            <div id="powerupsContainer"></div>
            
            <div class="car-wrapper" id="playerCar">
                <div class="car-body" id="carBody">
                    <div class="spoiler"></div>
                    <div class="roof"></div>
                    <div class="hood-vent"></div>
                    <div class="lights-front"></div>
                    <div class="nitro-flame" id="nitroFlame"></div>
                </div>
            </div>

            <div id="particlesContainer"></div>
        </div>
    </div>

    <div class="controls-overlay">
        <div class="d-pad">
            <button id="btnLeft" class="ctrl-btn left-btn">â—€</button>
            <button id="btnRight" class="ctrl-btn right-btn">â–¶</button>
        </div>
        
        <div class="pedals">
            <button id="btnNitro" class="ctrl-btn nitro-btn">ğŸš€</button>
            <div class="pedal-group">
                <button id="btnBrake" class="ctrl-btn brake-btn">II</button>
                <button id="btnGas" class="ctrl-btn gas-btn">âš¡</button>
            </div>
        </div>
    </div>

    <div class="game-over" id="gameOver">
        <h2>ğŸ’¥ Game Over!</h2>
        <p>Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="finalScore">0</span></p>
        <p>Ø§Ù„Ø¹Ù…Ù„Ø§Øª: <span id="finalCoins">0</span></p>
        <button onclick="restartGame()">ğŸ”„ Ø§Ù„Ø¹Ø¨ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰</button>
    </div>

    <script>
        // Ø§Ù„Ø¹Ù†Ø§ØµØ±
        const car = document.getElementById('playerCar');
        const carBody = document.getElementById('carBody');
        const gameWorld = document.getElementById('gameWorld');
        const nitroFlame = document.getElementById('nitroFlame');
        const particlesContainer = document.getElementById('particlesContainer');
        const skidMarksContainer = document.getElementById('skidMarksContainer');
        const coinsContainer = document.getElementById('coinsContainer');
        const powerupsContainer = document.getElementById('powerupsContainer');
        const speedDisplay = document.getElementById('speedVal');
        const coinsDisplay = document.getElementById('coins');
        const scoreDisplay = document.getElementById('score');
        const levelDisplay = document.getElementById('level');
        const gameOverScreen = document.getElementById('gameOver');
        const carSelect = document.getElementById('carSelect');

        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø©
        let gameData = {
            coins: 0,
            score: 0,
            level: 1,
            totalCoins: localStorage.getItem('totalCoins') ? parseInt(localStorage.getItem('totalCoins')) : 0,
            selectedCar: 'yellow',
            shield: false,
            multiplier: 1
        };

        let physics = {
            x: window.innerWidth / 2,
            y: window.innerHeight / 2,
            angle: 0,
            speed: 0,
            maxSpeed: 12,
            maxNitroSpeed: 18,
            acceleration: 0.3,
            friction: 0.96,
            turnSpeed: 4.5
        };

        let controls = { up: false, down: false, left: false, right: false, nitro: false };
        let gameActive = false;
        let coinsArray = [];
        let powerupsArray = [];

        // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³ÙŠØ§Ø±Ø©
        document.querySelectorAll('.car-option').forEach(option => {
            option.addEventListener('click', function() {
                const carType = this.dataset.car;
                if(carType === 'yellow') {
                    startWithCar('yellow');
                } else if(carType === 'blue' && gameData.totalCoins >= 50) {
                    gameData.totalCoins -= 50;
                    localStorage.setItem('totalCoins', gameData.totalCoins);
                    startWithCar('blue');
                } else if(carType === 'red' && gameData.totalCoins >= 100) {
                    gameData.totalCoins -= 100;
                    localStorage.setItem('totalCoins', gameData.totalCoins);
                    startWithCar('red');
                } else {
                    alert('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ Ø¹Ù…Ù„Ø§Øª ÙƒØ§ÙÙŠØ©! ğŸª™');
                }
            });
        });

        function startWithCar(type) {
            gameData.selectedCar = type;
            carBody.className = 'car-body';
            if(type === 'blue') {
                carBody.classList.add('blue');
                physics.maxSpeed = 15;
                physics.maxNitroSpeed = 22;
            } else if(type === 'red') {
                carBody.classList.add('red');
                physics.maxSpeed = 18;
                physics.maxNitroSpeed = 25;
                physics.acceleration = 0.5;
            }
            carSelect.style.display = 'none';
            gameActive = true;
            gameLoop();
        }

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        function setupButton(id, key) {
            const btn = document.getElementById(id);
            btn.addEventListener('touchstart', (e) => { e.preventDefault(); controls[key] = true; }, {passive: false});
            btn.addEventListener('touchend', (e) => { e.preventDefault(); controls[key] = false; }, {passive: false});
            btn.addEventListener('mousedown', () => controls[key] = true);
            btn.addEventListener('mouseup', () => controls[key] = false);
            btn.addEventListener('mouseleave', () => controls[key] = false);
        }

        setupButton('btnGas', 'up');
        setupButton('btnBrake', 'down');
        setupButton('btnLeft', 'left');
        setupButton('btnRight', 'right');
        setupButton('btnNitro', 'nitro');

        // Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
        document.addEventListener('keydown', (e) => {
            if(e.key === 'ArrowUp') controls.up = true;
            if(e.key === 'ArrowDown') controls.down = true;
            if(e.key === 'ArrowLeft') controls.left = true;
            if(e.key === 'ArrowRight') controls.right = true;
            if(e.code === 'Space') controls.nitro = true;
        });
        document.addEventListener('keyup', (e) => {
            if(e.key === 'ArrowUp') controls.up = false;
            if(e.key === 'ArrowDown') controls.down = false;
            if(e.key === 'ArrowLeft') controls.left = false;
            if(e.key === 'ArrowRight') controls.right = false;
            if(e.code === 'Space') controls.nitro = false;
        });

        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¹Ù…Ù„Ø§Øª
        function spawnCoin() {
            if(coinsArray.length < 10 && Math.random() < 0.02) {
                const coin = document.createElement('div');
                coin.className = 'coin';
                coin.innerHTML = 'ğŸª™';
                coin.style.left = Math.random() * (window.innerWidth - 50) + 'px';
                coin.style.top = Math.random() * (window.innerHeight - 50) + 'px';
                coinsContainer.appendChild(coin);
                coinsArray.push({
                    el: coin,
                    x: parseFloat(coin.style.left),
                    y: parseFloat(coin.style.top)
                });
            }
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¨ÙˆÙ†ØµØ§Øª
        function spawnPowerup() {
            if(powerupsArray.length < 2 && Math.random() < 0.005) {
                const powerup = document.createElement('div');
                powerup.className = 'powerup ' + (Math.random() < 0.5 ? 'shield' : 'multi');
                powerup.innerHTML = powerup.classList.contains('shield') ? 'ğŸ›¡ï¸' : 'âš¡';
                powerup.style.left = Math.random() * (window.innerWidth - 50) + 'px';
                powerup.style.top = Math.random() * (window.innerHeight - 50) + 'px';
                powerupsContainer.appendChild(powerup);
                powerupsArray.push({
                    el: powerup,
                    type: powerup.classList.contains('shield') ? 'shield' : 'multi',
                    x: parseFloat(powerup.style.left),
                    y: parseFloat(powerup.style.top)
                });
            }
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØµØ§Ø¯Ù…
        function checkCollisions() {
            // Ø§Ù„Ø¹Ù…Ù„Ø§Øª
            coinsArray.forEach((coin, idx) => {
                const dx = physics.x - coin.x - 17;
                const dy = physics.y - coin.y - 17;
                const dist = Math.sqrt(dx*dx + dy*dy);
                if(dist < 40) {
                    coin.el.remove();
                    coinsArray.splice(idx, 1);
                    gameData.coins++;
                    gameData.totalCoins++;
                    gameData.score += 10 * gameData.multiplier;
                    playSoun
